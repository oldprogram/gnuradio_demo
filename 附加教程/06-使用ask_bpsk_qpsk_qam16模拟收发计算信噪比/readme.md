### 前言

在《[GNU Radio 附加教程（三）][#1]》中，我们成功实现了多种调制方式的 **误码率(BER)** 测量。然而，要完整评估通信系统的性能，**信噪比 (SNR)** 是最核心的自变量。本文将介绍一种在 GNU Radio 中利用 **带外噪声估计法** 实时计算 SNR 的实用方法。

</br>

### 一、 测量原理：带外噪声估计法

在模拟信道中，我们通常假设底噪是**加性高斯白噪声（AWGN）**。这意味着噪声在频域内是均匀分布的（平坦的）。利用这一特性，我们可以通过对比“信号带宽内”和“信号带宽外”的功率来估算 SNR。

#### 1. 核心步骤
* **信号+噪声窗口 (信号 A)：** 使用带通滤波器（-7kHz ~ -3kHz）提取。此时测得的功率 $P_A = P_{signal} + P_{noise\_A}$。
* **纯噪声窗口 (信号 B)：** 使用相同带宽的带通滤波器（-44kHz ~ -40kHz）在信号主瓣之外提取。此时测得的功率 $P_B = P_{noise\_B}$。

#### 2. 计算公式
由于噪声是平坦的，且两个窗口带宽相同，则 $P_{noise\_A} \approx P_{noise\_B}$。
纯信号功率可表示为：$P_{signal} = P_A - P_B$。

根据定义，信噪比公式为：
$$SNR = 10 \log_{10} \left( \frac{P_A - P_B}{P_B} \right)$$

</br>

### 二、 GNU Radio 流程图实现要点

#### 1. 滤波器配置

为了保证计算的准确性，必须严格控制两个带通滤波器（Band Pass Filter）的参数：

* **带宽对称：** 信号窗口 A（宽度 4kHz）与噪声窗口 B（宽度 4kHz）必须完全相等。
* **增益一致：** 两个滤波器的 `Gain` 均设为 1。
* **窗口选择：** 确保窗口 B 所在的频段（-44k~-40k）没有信号旁瓣泄露，建议在 **Frequency Sink** 中观察确认。

</br>

#### 2. 功率计算模块

在滤波器后，我们需要将复数基带信号转换为功率标量：

* 使用 **Complex to Mag ^ 2** 模块：直接输出电压平方值，即瞬时功率。
* 使用 **Moving Average**（移动平均）模块：由于噪声具有随机性，瞬时功率波动剧烈。通过该模块取均值（如设置 1000 个采样点），可以获得稳定的功率估值。

</br>

#### 3. 流程图实现

因此在《[GNU Radio 附加教程（三）][#1]》中的流程图基础上增加下面流程：

![][p1]

</br>

#### 4. 针对不同调制方式的注意事项

在测试 ASK, BPSK, QPSK, QAM16 时，请留意以下差异：

| 调制方式 | 频谱特点 | 测量建议 |
| --- | --- | --- |
| **ASK / BPSK** | 能量集中在载波/主瓣 | 窗口 A 必须完整覆盖主瓣以获得准确功率。 |
| **QPSK / QAM16** | 频谱效率高，主瓣较宽 | 需确保符号率（Symbol Rate）不会导致旁瓣进入窗口 B。 |
| **成形滤波** | RRC 滤波器会压制旁瓣 | 使用 RRC 后，带外噪声测量将变得非常纯净。 |

</br>

运行后的效果为：

![][p2]    

</br>

### 三、从 SNR 到 Eb/N0
#### 1. 计算公式

在通信系统的理论分析中，**SNR（信噪比）** 是针对特定测量带宽的感官指标，而 $E_b/N_0$（**每比特能量与噪声功率谱密度之比**） 则是衡量调制方式效率的“金标准”。

计算公式用分贝 (dB) 表示为：

$$ (\frac{E_b}{N_0})\_{dB} = SNR_{dB} + 10 \log_{10}(B) - 10 \log_{10}(R_b)$$

- $SNR_{linear}$ (信噪比线性值)：这是你通过 $10 \lg((A-B)/B)$ 得到的线性比值。它代表了在你的滤波器带宽 
$B$ 内，信号功率与噪声功率的比值。
- $B$ (等效噪声带宽)：在你实验中，这就是带通滤波器的宽度（4kHz）。
    - 注意：噪声功率 $P_n$ 是随带宽 $B$ 变化的（$P_n = N_0 \cdot B$），所以 SNR 会随滤波器变宽而减小。
- $R_b$ (净比特率 - Net Bit Rate)：指每秒传输的有效二进制位数。
    - 公式为：$R_b = R_s \cdot \log_2(M)$
    - 其中 $R_s$ 是符号速率（Symbol Rate），
- $M$ 是调制阶数（如 QPSK 的 $M=4$）。

</br>

#### 2. 结果解读

**a）数学层面的含义** 

$E_b/N_0$ 是一个比值，转换成 dB 的公式是 $10 \log_{10}(E_b/N_0)$。

- 当 $E_b/N_0 > 1$ 时，dB 值为正。
- 当 $E_b/N_0 = 1$ 时，dB 值为 $0$。
- 当 $E_b/N_0 < 1$ 时，dB 值为负数。

当得到的结果为负数时（db 方式）意味着 Eb < N0。也就是说，你为了传输 1 bit 数据所投入的能量，还不如 1 Hz 带宽内的噪声功率大。

</br>

**b）香农极限（Shannon Limit）：理论底线** 

通信理论中有一个著名的极限 —— **香农极限**。在带宽无限大的理想情况下，能够实现可靠传输（误码率趋近于 0）的最小 $E_b/N_0$ 是 $-1.59 \text{ dB}$。

- 如果你的 $E_b/N_0$ 是 $-1 \text{ dB}$，理论上通过极其复杂的编码（如 LDPC 或 Turbo 码），你仍然可以实现无差错传输。
- 如果你的 $E_b/N_0$ 小于 $-1.59 \text{ dB}$，那么无论采用什么技术，误码率都无法降低到 0。

</br>

**c）负 $E_b/N_0$ 的实际应用场景**

虽然在普通的 BPSK/QPSK 仿真中，$E_b/N_0$ 为负通常意味着系统无法工作，但在以下领域，负 $E_b/N_0$ 是常态：

- 扩频通信 (Spread Spectrum/CDMA)：通过将信号散布在极宽的频带上，即便单比特能量远低于噪声（$E_b/N_0 < 0$），接收端通过相关运算（处理增益）依然能把信号“捞”出来。
- 深空通信：由于距离极远，到达地球的信号极弱，通常在极负的 $E_b/N_0$ 下工作，依赖极低的数据速率和超强的纠错码。
- 隐蔽通信： 故意让信号沉溺在噪声底波之下（负 SNR），让敌方截获者以为这只是随机噪声。

</br>

### 四、总结与进阶建议

通过本文的方法，你已经在 GNU Radio 中建立了一套完整的性能评估体系：

- **频域：** 通过带通滤波器观察信号与噪声的功率分布。
- **时域/统计：** 通过误码率计算模块统计实时 BER。
- **理论连接：** 通过 $E_b/N_0$ 换算，将实测点标注在经典的误码率曲线上。

![][p3]

[#1]:https://www.bilibili.com/video/BV1My9wYFEJP/?vd_source=e07622425aaa33ca0b1e9dafa0807cf4     
[p1]:https://tuchuang.beautifulzzzz.com:3000/?path=202601/SNR_to_EbN0_grc.png    
[p2]:https://tuchuang.beautifulzzzz.com:3000/?path=202601/SNR_to_EbN0_grc_show.gif      
[p3]:https://tuchuang.beautifulzzzz.com:3000/?path=202601/Est_BER_vs_EbN0.png      

   
